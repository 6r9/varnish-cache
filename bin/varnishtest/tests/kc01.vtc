varnishtest "Test Key matcher functionality (CASE)"

server s1 {
	rxreq
	txresp -hdr "Key: Foobar;b=\"A\""
	rxreq
	txresp -hdr "Key: Foobar;c;b=\"B\""
	rxreq
	txresp -hdr "Key: Foobar;c;b=\"B\""
} -start

varnish v1 -vcl+backend {} -start

client c1 {
	txreq -hdr "Foobar: Apple"
	rxresp
	expect resp.status == 200
	expect resp.http.X-Varnish == "1001"

	txreq -hdr "Foobar: ardvark"
	rxresp
	expect resp.status == 200
	expect resp.http.X-Varnish == "1003 1002"

	txreq -hdr "Foobar: Ball"
	rxresp
	expect resp.status == 200
	expect resp.http.X-Varnish == "1004"

	txreq -hdr "Foobar: brick"
	rxresp
	expect resp.status == 200
	expect resp.http.X-Varnish == "1006"
} -run
